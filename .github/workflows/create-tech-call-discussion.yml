name: Create FAIR Tech Call Weekly Discussion

on:
  workflow_dispatch:
  schedule:
    - cron: '30 17 * * 0'  # Every Sunday at 17:30 UTC

permissions:
  contents: read

jobs:
  post-monday-discussion:
    runs-on: ubuntu-latest
    steps:
      - name: Set up dynamic values
        id: vars
        run: |
          # Target tomorrow (Monday) for meeting date
          MEETING_DATE=$(date -u -d "tomorrow" +'%Y-%m-%d')
          DISPLAY_DATE=$(date -u -d "tomorrow" +'%B %d, %Y')
          TZ_LINK="https://www.timeanddate.com/worldclock/fixedtime.html?iso=${MEETING_DATE//-}T1730"

          echo "date_slug=$MEETING_DATE" >> $GITHUB_OUTPUT
          echo "date_display=$DISPLAY_DATE" >> $GITHUB_OUTPUT
          echo "tz_link=$TZ_LINK" >> $GITHUB_OUTPUT

      - name: Create GitHub Discussion
        uses: abirismyname/create-discussion@v2.1.0
        with:
          github-token: ${{ secrets.DISCUSSION_PAT }}
          repository-name: fairpm/tsc
          category-name: General
          title: "Tech Call Agenda - ${{ steps.vars.outputs.date_slug }}"
          body: |
            **Meeting Purpose:** Deep-dive, hands-on technical work & implementation for FAIR.

            **Audience:** All technical contributors (not just committee members).

            Please add agenda items as comments below and up-vote on the items you'd like to discuss.

            ## Meeting details
            * Meeting is ${{ steps.vars.outputs.date_display }} â€“ 17:30 UTC ([see it in your time zone](${{ steps.vars.outputs.tz_link }}))
            * [Link to Meeting Calendar](https://zoom-lfx.platform.linuxfoundation.org/meeting/98982564470?password=5143c55f-4b07-4914-9666-cc55daca752d)

            ## How to join
            This call is open to anyone, but note that you need to have a profile/account at [OpenProfile.dev](https://openprofile.dev/) to join the call.

            ## Reminders

            FAIR is part of the Linux Foundation. Meeting attendees are subject to both the [Code of Conduct](https://github.com/fairpm/tsc/blob/main/code-of-conduct.md) and the [LF Antitrust Policy](https://www.linuxfoundation.org/legal/antitrust-policy).

            This meeting is recorded and publicly available via your OpenProfile.dev account.
